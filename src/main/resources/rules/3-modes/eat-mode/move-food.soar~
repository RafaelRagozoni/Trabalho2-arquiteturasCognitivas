# Propose*move*food:
sp {propose*move*food
   (state <s> ^name eat-mode
              ^superstate <ss>)
   (<ss> ^io.input-link <il>
         ^name 3-modes
         ^CREATURE <CREATURE>)
   (<CREATURE> ^POSITION <position>
               ^MEMORY.ENTITY <ENTITY>)
   (<position> ^X <creatureX>
               ^Y <creatureY>)                
   (<ENTITY> ^TYPE FOOD
             ^NAME <foodName>
             ^X <X>
             ^Y <Y>)
  -(<ENTITY> ^DISTANCE <distance> < 30)
-->
   (<s> ^operator <op> + =)
   (<op> ^name move-food
         ^FOOD_NAME <foodName>
         ^FOOD_X <X>
         ^FOOD_Y <Y>
         ^DISTANCE (sqrt (+ (* (- <creatureX> <X>) (- <creatureX> <X>)) (* (- <creatureY> <Y>) (- <creatureY> <Y>)))))
}
# Apply*move*food:
# If the move operator is selected, then generate an output command to it 
sp {apply*move*food
   (state <s> ^name eat-mode
              ^operator <o>
              ^superstate <ss>)
   (<ss> ^name 3-modes
         ^io <io>)
   (<io> ^input-link <il>)             
   (<io> ^output-link <ol>)
   (<o> ^name move-food
        ^FOOD_X <x>
        ^FOOD_Y <y>
        ^FOOD_NAME <foodName>
        ^DISTANCE <distance>)
   (<ss> ^CREATURE <creature>)
   (<creature> ^MEMORY <memory>
               ^POSITION <position>)
   (<position> ^X <creatureX>
               ^Y <creatureY>)
   (<memory> ^ENTITY <entityInMemory>)
   (<entityInMemory> ^NAME <foodName>)
-->
   (<ol> ^MOVE <command>)
   (<command> ^Vel 1)
   (<command> ^VelR 1)
   (<command> ^VelL 1)
   (<command> ^X <x>)
   (<command> ^Y <y>)
   (<position> ^X <creatureX> -
               ^Y <creatureY> -
               ^X <x>
               ^Y <y>)
   (<creature> ^MEMORY <memory> -)
   (<creature> ^MEMORY <newMemory>)
#   (<entityInMemory> ^DISTANCE 0)

   #(halt)
}